# Rust Coding Preferences
# These rules represent how I like Rust code to be structured

[[rules]]
name = "syntax_error"
query = "(ERROR) @error"
severity = "error"
message = "Syntax error"
suggestion = "Fix the syntax error before proceeding."
enabled = true
weight = 2.0

[[rules]]
name = "large_match_prefer_functions"
query = '''
(match_expression
  body: (match_block
    (match_arm
      value: (block) @body
      (#match? @body "(?s)(\\b(let|if|else|match|while|for|loop|return|break|continue)\\b|;[^}]*;)")
    ) @arm
  )
) @match
'''
severity = "info"
message = "Match arm contains inline logic"
suggestion = "I prefer match statements to be split into separate functions. Each match arm should call a dedicated function rather than containing inline logic. This makes code more testable and easier to navigate."
enabled = true
weight = 1.5

[[rules]]
name = "prefer_smaller_functions"
query = """
(function_item
  body: (block
    (_)
    (_)
    (_)
    (_)
    (_)
    (_)
    (_)
    (_)
    (_)
    (_)
    (_)?
    (_)?
  ) @body
  (#match? @body "(?s)\\b(let|if|match|for|while|loop|return|break|continue)\\b")
) @function
"""
severity = "warning"
message = "Function exceeds 25 lines"
suggestion = "I prefer functions to be focused and small (25 lines max). If a function is doing multiple things, split it up so each has a single, clear purpose."
enabled = true
weight = 1.8
max_function_lines = 25

[[rules]]
name = "avoid_deep_nesting"
query = "(if_expression consequence: (block (if_expression consequence: (block (if_expression) @deep_if))))"
severity = "warning"
message = "Deep nesting detected"
suggestion = "I prefer flat code with guard clauses and early returns over deep nesting. This makes the happy path easier to follow."
enabled = true
weight = 1.6

[[rules]]
name = "no_unwrap_prefer_error_handling"
query = '(call_expression function: (field_expression field: (field_identifier) @method) (#eq? @method "unwrap")) @call'
severity = "warning"
message = "Use of .unwrap()"
suggestion = "I prefer proper error handling over .unwrap(). Use .expect() with a descriptive message, or better yet, use ? operator and let errors propagate."
enabled = true
weight = 1.5

[[rules]]
name = "prefer_descriptive_names"
query = "(parameters (parameter) @p1 (parameter) @p2 (parameter) @p3 (parameter) @p4 (parameter) @p5) @params"
severity = "style"
message = "Many function parameters"
suggestion = "I prefer functions with few parameters. If you need many parameters, group related ones into a struct with descriptive field names."
enabled = true
weight = 1.3

[[rules]]
name = "todos_should_be_issues"
query = '(line_comment) @comment (#match? @comment "TODO|FIXME")'
severity = "info"
message = "TODO comment found"
suggestion = "I prefer tracking TODOs as issues rather than comments. If it's important enough to note, create a proper issue."
enabled = true
weight = 0.3
